<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="902px" preserveAspectRatio="none" style="width:919px;height:902px;background:#FFFFFF;" version="1.1" viewBox="0 0 919 902" width="919px" zoomAndPan="magnify"><defs/><g><ellipse cx="584.375" cy="15" fill="#FFFFFF" rx="10" ry="10" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#FFFFFF" height="47.9375" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="164" x="502.375" y="45"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="112" x="512.375" y="66.1387">Incoming Request</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="144" x="512.375" y="80.1074">/parents-kids/users/me</text><path d="M660.875,124.3398 L660.875,132.9063 L640.875,136.9063 L660.875,140.9063 L660.875,149.4727 A0,0 0 0 0 660.875,149.4727 L912.875,149.4727 A0,0 0 0 0 912.875,149.4727 L912.875,134.3398 L902.875,124.3398 L660.875,124.3398 A0,0 0 0 0 660.875,124.3398 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M902.875,124.3398 L902.875,134.3398 L912.875,134.3398 L902.875,124.3398 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="231" x="666.875" y="141.4067">/parents-kids â†’ parents-kids-service</text><rect fill="#FFFFFF" height="47.9375" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="113" x="527.875" y="112.9375"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="93" x="537.875" y="134.0762">Extract Service</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="61" x="537.875" y="148.0449">from Path</text><rect fill="#FFFFFF" height="47.9375" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="142" x="513.375" y="180.875"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="122" x="523.375" y="202.0137">Load Security Rules</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="66" x="523.375" y="215.9824">for Service</text><rect fill="#FFFFFF" height="47.9375" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="125" x="521.875" y="248.8125"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="105" x="531.875" y="269.9512">Find All Matching</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="85" x="531.875" y="283.9199">Rule Patterns</text><polygon fill="#FFFFFF" points="523.875,316.75,644.875,316.75,656.875,328.75,644.875,340.75,523.875,340.75,511.875,328.75,523.875,316.75" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="121" x="523.875" y="332.5581">Multiple Rules Match?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="491.875" y="326.1558">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="656.875" y="326.1558">no</text><path d="M470.875,350.75 L470.875,374.4492 L450.875,378.4492 L470.875,382.4492 L470.875,406.1484 A0,0 0 0 0 470.875,406.1484 L700.875,406.1484 A0,0 0 0 0 700.875,406.1484 L700.875,360.75 L690.875,350.75 L470.875,350.75 A0,0 0 0 0 470.875,350.75 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><path d="M690.875,350.75 L690.875,360.75 L700.875,360.75 L690.875,350.75 " fill="#FFFFFF" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="169" x="476.875" y="367.8169">More specific patterns win:</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="209" x="476.875" y="382.9497">- Longer patterns = higher score</text><text fill="#000000" font-family="Verdana" font-size="13" lengthAdjust="spacing" textLength="206" x="476.875" y="398.0825">- Fewer wildcards = higher score</text><rect fill="#FFFFFF" height="47.9375" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="184" x="266.875" y="354.4805"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="164" x="276.875" y="375.6191">Calculate Specificity Score</text><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="83" x="276.875" y="389.5879">for Each Rule</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="176" x="270.875" y="426.1484"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="156" x="280.875" y="447.2871">Select Most Specific Rule</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="178" x="720.875" y="350.75"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="158" x="730.875" y="371.8887">Use Single Matching Rule</text><polygon fill="#FFFFFF" points="584.375,466.1172,596.375,478.1172,584.375,490.1172,572.375,478.1172,584.375,466.1172" style="stroke:#000000;stroke-width:1.0;"/><polygon fill="#FFFFFF" points="550.375,510.1172,618.375,510.1172,630.375,522.1172,618.375,534.1172,550.375,534.1172,538.375,522.1172,550.375,510.1172" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="68" x="550.375" y="525.9253">Rule Found?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="518.375" y="519.5229">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="630.375" y="519.5229">no</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="84" x="384.25" y="544.1172"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="64" x="394.25" y="565.2559">Apply Rule</text><polygon fill="#FFFFFF" points="356.25,598.0859,496.25,598.0859,508.25,610.0859,496.25,622.0859,356.25,622.0859,344.25,610.0859,356.25,598.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="140" x="356.25" y="613.894">Authentication Required?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="324.25" y="607.4917">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="508.25" y="607.4917">no</text><polygon fill="#FFFFFF" points="244,632.0859,300,632.0859,312,644.0859,300,656.0859,244,656.0859,232,644.0859,244,632.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="56" x="244" y="647.894">Valid JWT?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="212" y="641.4917">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="312" y="641.4917">no</text><polygon fill="#FFFFFF" points="97,666.0859,174,666.0859,186,678.0859,174,690.0859,97,690.0859,85,678.0859,97,666.0859" style="stroke:#000000;stroke-width:1.0;"/><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="77" x="97" y="681.894">Role Allowed?</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="20" x="65" y="675.4917">yes</text><text fill="#000000" font-family="Verdana" font-size="11" lengthAdjust="spacing" textLength="14" x="186" y="675.4917">no</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="107" x="6" y="700.0859"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="87" x="16" y="721.2246">Allow Request</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="157" x="133" y="700.0859"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="137" x="143" y="721.2246">Return 403 Forbidden</text><polygon fill="#FFFFFF" points="135.5,740.0547,147.5,752.0547,135.5,764.0547,123.5,752.0547,135.5,740.0547" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="177" x="320" y="666.0859"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="157" x="330" y="687.2246">Return 401 Unauthorized</text><polygon fill="#FFFFFF" points="272,770.0547,284,782.0547,272,794.0547,260,782.0547,272,770.0547" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="107" x="527" y="632.0859"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="87" x="537" y="653.2246">Allow Request</text><polygon fill="#FFFFFF" points="426.25,800.0547,438.25,812.0547,426.25,824.0547,414.25,812.0547,426.25,800.0547" style="stroke:#000000;stroke-width:1.0;"/><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="152" x="666.5" y="544.1172"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="132" x="676.5" y="565.2559">Default: Deny Access</text><rect fill="#FFFFFF" height="33.9688" rx="12.5" ry="12.5" style="stroke:#000000;stroke-width:1.0;" width="157" x="664" y="598.0859"/><text fill="#000000" font-family="Verdana" font-size="12" lengthAdjust="spacing" textLength="137" x="674" y="619.2246">Return 403 Forbidden</text><polygon fill="#FFFFFF" points="584.375,830.0547,596.375,842.0547,584.375,854.0547,572.375,842.0547,584.375,830.0547" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="584.375" cy="885.0547" fill="#FFFFFF" rx="11" ry="11" style="stroke:#000000;stroke-width:1.0;"/><ellipse cx="584.375" cy="885.0547" fill="#000000" rx="6" ry="6" style="stroke:#7F7F7F;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="25" y2="45"/><polygon fill="#000000" points="580.375,35,584.375,45,588.375,35,584.375,39" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="92.9375" y2="112.9375"/><polygon fill="#000000" points="580.375,102.9375,584.375,112.9375,588.375,102.9375,584.375,106.9375" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="160.875" y2="180.875"/><polygon fill="#000000" points="580.375,170.875,584.375,180.875,588.375,170.875,584.375,174.875" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="228.8125" y2="248.8125"/><polygon fill="#000000" points="580.375,238.8125,584.375,248.8125,588.375,238.8125,584.375,242.8125" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="358.875" x2="358.875" y1="402.418" y2="426.1484"/><polygon fill="#000000" points="354.875,416.1484,358.875,426.1484,362.875,416.1484,358.875,420.1484" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="511.875" x2="358.875" y1="328.75" y2="328.75"/><line style="stroke:#000000;stroke-width:1.0;" x1="358.875" x2="358.875" y1="328.75" y2="354.4805"/><polygon fill="#000000" points="354.875,344.4805,358.875,354.4805,362.875,344.4805,358.875,348.4805" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="656.875" x2="809.875" y1="328.75" y2="328.75"/><line style="stroke:#000000;stroke-width:1.0;" x1="809.875" x2="809.875" y1="328.75" y2="350.75"/><polygon fill="#000000" points="805.875,340.75,809.875,350.75,813.875,340.75,809.875,344.75" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="358.875" x2="358.875" y1="460.1172" y2="478.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="358.875" x2="572.375" y1="478.1172" y2="478.1172"/><polygon fill="#000000" points="562.375,474.1172,572.375,478.1172,562.375,482.1172,566.375,478.1172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="809.875" x2="809.875" y1="384.7188" y2="478.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="809.875" x2="596.375" y1="478.1172" y2="478.1172"/><polygon fill="#000000" points="606.375,474.1172,596.375,478.1172,606.375,482.1172,602.375,478.1172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="296.75" y2="316.75"/><polygon fill="#000000" points="580.375,306.75,584.375,316.75,588.375,306.75,584.375,310.75" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="85" x2="59.5" y1="678.0859" y2="678.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="59.5" x2="59.5" y1="678.0859" y2="700.0859"/><polygon fill="#000000" points="55.5,690.0859,59.5,700.0859,63.5,690.0859,59.5,694.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="186" x2="211.5" y1="678.0859" y2="678.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="211.5" x2="211.5" y1="678.0859" y2="700.0859"/><polygon fill="#000000" points="207.5,690.0859,211.5,700.0859,215.5,690.0859,211.5,694.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="59.5" x2="59.5" y1="734.0547" y2="752.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="59.5" x2="123.5" y1="752.0547" y2="752.0547"/><polygon fill="#000000" points="113.5,748.0547,123.5,752.0547,113.5,756.0547,117.5,752.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="211.5" x2="211.5" y1="734.0547" y2="752.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="211.5" x2="147.5" y1="752.0547" y2="752.0547"/><polygon fill="#000000" points="157.5,748.0547,147.5,752.0547,157.5,756.0547,153.5,752.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="232" x2="135.5" y1="644.0859" y2="644.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="135.5" x2="135.5" y1="644.0859" y2="666.0859"/><polygon fill="#000000" points="131.5,656.0859,135.5,666.0859,139.5,656.0859,135.5,660.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="312" x2="408.5" y1="644.0859" y2="644.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="408.5" x2="408.5" y1="644.0859" y2="666.0859"/><polygon fill="#000000" points="404.5,656.0859,408.5,666.0859,412.5,656.0859,408.5,660.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="135.5" x2="135.5" y1="764.0547" y2="782.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="135.5" x2="260" y1="782.0547" y2="782.0547"/><polygon fill="#000000" points="250,778.0547,260,782.0547,250,786.0547,254,782.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="408.5" x2="408.5" y1="700.0547" y2="782.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="408.5" x2="284" y1="782.0547" y2="782.0547"/><polygon fill="#000000" points="294,778.0547,284,782.0547,294,786.0547,290,782.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="344.25" x2="272" y1="610.0859" y2="610.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="272" x2="272" y1="610.0859" y2="632.0859"/><polygon fill="#000000" points="268,622.0859,272,632.0859,276,622.0859,272,626.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="508.25" x2="580.5" y1="610.0859" y2="610.0859"/><line style="stroke:#000000;stroke-width:1.0;" x1="580.5" x2="580.5" y1="610.0859" y2="632.0859"/><polygon fill="#000000" points="576.5,622.0859,580.5,632.0859,584.5,622.0859,580.5,626.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="272" x2="272" y1="794.0547" y2="812.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="272" x2="414.25" y1="812.0547" y2="812.0547"/><polygon fill="#000000" points="404.25,808.0547,414.25,812.0547,404.25,816.0547,408.25,812.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="580.5" x2="580.5" y1="666.0547" y2="812.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="580.5" x2="438.25" y1="812.0547" y2="812.0547"/><polygon fill="#000000" points="448.25,808.0547,438.25,812.0547,448.25,816.0547,444.25,812.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="426.25" x2="426.25" y1="578.0859" y2="598.0859"/><polygon fill="#000000" points="422.25,588.0859,426.25,598.0859,430.25,588.0859,426.25,592.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="742.5" x2="742.5" y1="578.0859" y2="598.0859"/><polygon fill="#000000" points="738.5,588.0859,742.5,598.0859,746.5,588.0859,742.5,592.0859" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="538.375" x2="426.25" y1="522.1172" y2="522.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="426.25" x2="426.25" y1="522.1172" y2="544.1172"/><polygon fill="#000000" points="422.25,534.1172,426.25,544.1172,430.25,534.1172,426.25,538.1172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="630.375" x2="742.5" y1="522.1172" y2="522.1172"/><line style="stroke:#000000;stroke-width:1.0;" x1="742.5" x2="742.5" y1="522.1172" y2="544.1172"/><polygon fill="#000000" points="738.5,534.1172,742.5,544.1172,746.5,534.1172,742.5,538.1172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="426.25" x2="426.25" y1="824.0547" y2="842.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="426.25" x2="572.375" y1="842.0547" y2="842.0547"/><polygon fill="#000000" points="562.375,838.0547,572.375,842.0547,562.375,846.0547,566.375,842.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="742.5" x2="742.5" y1="632.0547" y2="842.0547"/><line style="stroke:#000000;stroke-width:1.0;" x1="742.5" x2="596.375" y1="842.0547" y2="842.0547"/><polygon fill="#000000" points="606.375,838.0547,596.375,842.0547,606.375,846.0547,602.375,842.0547" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="490.1172" y2="510.1172"/><polygon fill="#000000" points="580.375,500.1172,584.375,510.1172,588.375,500.1172,584.375,504.1172" style="stroke:#000000;stroke-width:1.0;"/><line style="stroke:#000000;stroke-width:1.0;" x1="584.375" x2="584.375" y1="854.0547" y2="874.0547"/><polygon fill="#000000" points="580.375,864.0547,584.375,874.0547,588.375,864.0547,584.375,868.0547" style="stroke:#000000;stroke-width:1.0;"/><!--MD5=[8d8e77834f069d867df8be356322ea0f]
@startuml
!theme plain

start

:Incoming Request\n/parents-kids/users/me;

:Extract Service\nfrom Path;
note right: /parents-kids â†’ parents-kids-service

:Load Security Rules\nfor Service;

:Find All Matching\nRule Patterns;

if (Multiple Rules Match?) then (yes)
  :Calculate Specificity Score\nfor Each Rule;
  note right
    More specific patterns win:
    - Longer patterns = higher score
    - Fewer wildcards = higher score
  end note
  :Select Most Specific Rule;
else (no)
  :Use Single Matching Rule;
endif

if (Rule Found?) then (yes)
  :Apply Rule;
  if (Authentication Required?) then (yes)
    if (Valid JWT?) then (yes)
      if (Role Allowed?) then (yes)
        :Allow Request;
      else (no)
        :Return 403 Forbidden;
      endif
    else (no)
      :Return 401 Unauthorized;
    endif
  else (no)
    :Allow Request;
  endif
else (no)
  :Default: Deny Access;
  :Return 403 Forbidden;
endif

stop
@enduml

@startuml







<style>
  root {
    BackgroundColor white
    FontColor black
    FontName Verdana
    HyperLinkColor blue
    LineColor black
    LineThickness 1
    Margin 5
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  header {
    LineThickness 0
  }
  node {
    MaximumWidth 300
  }
  title {
    FontSize 22
    LineThickness 0
  }
</style>

skinparam ArrowLollipopColor black
skinparam BackgroundColor white
skinparam DefaultFontName Verdana
skinparam DefaultMonospacedFontName Courier
skinparam LifelineStrategy nosolid
skinparam ParticipantPadding 10
skinparam SequenceLifeLineBorderColor black
skinparam Shadowing false
skinparam UseBetaStyle true

skinparam Activity {
  BackgroundColor white
  BarColor black
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam Boundary {
  FontColor black
}
skinparam Box {
  Padding 5
}
skinparam CircledCharacter {
  FontColor black
  FontName Courier
  Radius 9
}
skinparam Class {
  BackgroundColor white
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam ClassAttribute {
  FontColor black
  FontName Verdana
}
skinparam ClassStereotype {
  FontColor black
  FontName Verdana
}
skinparam Footer {
  FontColor black
  FontName Verdana
}
skinparam Header {
  FontColor black
  FontName Verdana
}
skinparam Hyperlink {
  Color blue
}
skinparam IconPackage {
  Color black
  BackgroundColor white
}
skinparam IconPrivate {
  Color black
  BackgroundColor white
}
skinparam IconProtected {
  Color black
  BackgroundColor white
}
skinparam IconPublic {
  Color black
  BackgroundColor white
}
skinparam Note {
  FontColor black
  FontName Verdana
}
skinparam Object {
  BorderColor black
}
skinparam Package {
  BorderColor black
  FontColor black
  FontName Verdana
}
skinparam State {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeA {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeC {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeE {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeI {
  BackgroundColor white
  BorderColor black
}
skinparam StereotypeN {
  BackgroundColor white
  BorderColor black
}
skinparam UseCaseStereoType {
  FontColor black
  FontName Verdana
}

start

:Incoming Request\n/parents-kids/users/me;

:Extract Service\nfrom Path;
note right: /parents-kids â†’ parents-kids-service

:Load Security Rules\nfor Service;

:Find All Matching\nRule Patterns;

if (Multiple Rules Match?) then (yes)
  :Calculate Specificity Score\nfor Each Rule;
  note right
    More specific patterns win:
    - Longer patterns = higher score
    - Fewer wildcards = higher score
  end note
  :Select Most Specific Rule;
else (no)
  :Use Single Matching Rule;
endif

if (Rule Found?) then (yes)
  :Apply Rule;
  if (Authentication Required?) then (yes)
    if (Valid JWT?) then (yes)
      if (Role Allowed?) then (yes)
        :Allow Request;
      else (no)
        :Return 403 Forbidden;
      endif
    else (no)
      :Return 401 Unauthorized;
    endif
  else (no)
    :Allow Request;
  endif
else (no)
  :Default: Deny Access;
  :Return 403 Forbidden;
endif

stop
@enduml

PlantUML version 1.2022.7(Mon Aug 22 17:01:30 UTC 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>